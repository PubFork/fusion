"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels","./lang"],function(e,n,t,o,s){var i,a,r,c,l,u,d,f,p,h,y={appendCss:function(e){var n=document.createElement("link");return/\.less$/.test(e)?"object"===("undefined"==typeof less?"undefined":_typeof(less))?(n.rel="stylesheet/less",n.href=e,less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=e.replace(/less$/,"css")):(n.rel="stylesheet",n.href=e),(document.head||document.getElementsByTagName("head")[0]).appendChild(n)},removeCss:function(e){return $(e).remove(),"stylesheet/less"===e.rel&&(less.sheets.splice(less.sheets.indexOf(e),1),less.refresh()),e.getAttribute("href")},buildHash:function(e){var n,t="#!"+encodeURIComponent(e.id);for(n in e.args)t+=e.args[n]===undefined?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(e.args[n]);return t},parseHash:function(e){var t,o,s,a={id:i,args:{}};if((s=(e=e.substr(1).replace(/[#?].*$/,"")).match(/[^=&]+(=[^&]*)?/g))&&"!"===s[0].charAt(0))for(o=decodeURIComponent(s[0].substr(1)),n.hasOwnProperty(o)&&(a.id=o),t=1;t<s.length;t++)(o=s[t].match(/^([^=]+)(=)?(.+)?$/))&&(a.args[decodeURIComponent(o[1])]=o[2]?decodeURIComponent(o[3]||""):undefined);return a},isSameLocation:function(e,n){var t;if(e.id===n.id&&Object.keys(e.args).length===Object.keys(n.args).length){for(t in e.args){if(!n.args.hasOwnProperty(t))return!1;if(e.args[t]===undefined){if(e.args[t]!==n.args[t])return!1}else if(""+e.args[t]!=""+n.args[t])return!1}return!0}return!1},replaceLocation:function(e){y.location&&y.isSameLocation(e,y.location)?y.reloadPage():location.replace(y.buildHash(e))},getLang:function(e){if(navigator.languages){for(var n=0;n<navigator.languages.length;n++)if(e.hasOwnProperty(navigator.languages[n]))return e[navigator.languages[n]]}else if(e.hasOwnProperty(navigator.language))return e[navigator.language];return e.en}};return s=y.getLang(s),function(){y.listeners={add:function(e,n,t){e.xEvents||(e.xEvents=function(n){!function(e,n){var t,o;for(e.xEvents[n.type].locked=!0,t=0;t<e.xEvents[n.type].length;t++)e.xEvents[n.type][t].call(e,n);e.xEvents[n.type].locked=!1;for(;e.xEvents[n.type].stack.length;)e.xEvents[n.type].stack[0]?(o=e.xEvents[n.type].indexOf(e.xEvents[n.type].stack[0][1]),e.xEvents[n.type].stack[0][0]?o>=0&&e.xEvents[n.type].splice(o,1):o<0&&e.xEvents[n.type].push(e.xEvents[n.type].stack[0][1])):e.xEvents[n.type].splice(0,e.xEvents[n.type].length),e.xEvents[n.type].stack.shift();e.xEvents[n.type].length||(delete e.xEvents[n.type],e["on"+n.type]=null);if(e.xEvents.removeMark){for(t in delete e.xEvents.removeMark,e.xEvents)delete e.xEvents[t],e["on"+t]=null;delete e.xEvents}}(e,n)}),e.xEvents[n]||(e.xEvents[n]=[],e.xEvents[n].stack=[],e.xEvents[n].locked=!1,e["on"+n]=e.xEvents),e.xEvents[n].locked?e.xEvents[n].stack.push([!1,t]):e.xEvents[n].indexOf(t)<0&&e.xEvents[n].push(t)},list:function(e,n){var t,o;if(n)t=e.xEvents&&e.xEvents[n]?e.xEvents[n].slice(0):[];else if(t={},e.xEvents)for(o in e.xEvents)"array"===$.type(e.xEvents[o])&&e.xEvents[o].length&&(t[o]=e.xEvents[o].slice(0));return t},remove:function(e,n,t){var o,s,i;if(e.xEvents)if(n)e.xEvents[n]&&(e.xEvents[n].locked?t?e.xEvents[n].stack.push([!0,t]):e.xEvents[n].stack.push(null):t?(i=e.xEvents[n].indexOf(t))>=0&&e.xEvents[n].splice(i,1):e.xEvents[n].splice(0,e.xEvents[n].length),0===e.xEvents[n].length&&(delete e.xEvents[n],e["on"+n]=null));else if(!e.xEvents.removeMark){for(o in e.xEvents)e.xEvents[o].locked?s=!0:(delete e.xEvents[o],e["on"+o]=null);s?e.xEvents.removeMark=!0:delete e.xEvents}}}}(),function(){var e,n,t,s=$("#panel"),i=s.find(">.contents>div");function a(e,o){n=!0,i.animate({"margin-left":o?"-100%":"0%"},{duration:200,complete:function(){var o;n=!1,e(),"function"==typeof t&&(o=t,t=undefined,o())}})}function r(){if("function"!=typeof o[e].onunload||!o[e].onunload())return o[e].status--,a(function(){"function"==typeof o[e].onunloadend&&o[e].onunloadend(),o[e].status--,i.find(">."+e)[0].style.display=s[0].style.display="",o[e].autoDestroy&&v(o[e],"panel",e),e=undefined},!1),!0}y.openPanel=function(e,n){if(o.hasOwnProperty(e))return x("panel",o[e],e,function(){"function"==typeof o[e].open?o[e].open(n):y.showPanel(e)}),!0},y.showPanel=function(c){var l=0;return o[c].status>1&&(n?(t=y.showPanel.bind(this,c),l=2):e?e===c?("function"==typeof o[c].onload&&o[c].onload(),"function"==typeof o[c].onloadend&&o[c].onloadend(),l=1):r()&&(t=y.showPanel.bind(this,c),l=1):(o[c].status++,"function"==typeof o[c].onload&&o[c].onload(),s[0].className=e=c,s[0].style.display=i.find(">."+c)[0].style.display="block",a(function(){"function"==typeof o[c].onloadend&&o[c].onloadend(),o[c].status++},!0),l=1)),l},y.closePanel=function(o){var s=0;return n?(t=y.closePanel.bind(this,o),s=2):e&&(!o||e===o||"array"===$.type(o)&&o.indexOf(e)>=0)&&r()&&(s=1),s},y.destroyPanel=function(e){if(2===o[e].status)return v(o[e],"panel",e),!0},t=y.closePanel.bind(y,undefined),i.find(">.close").on("click",t),s.find(">.mask").on("click",t),t=undefined}(),function(){var e,n=document.getElementById("popup"),o=$(n).find(">div>div");y.openPopup=function(e,n){if(t.hasOwnProperty(e))return x("popup",t[e],e,function(){"function"==typeof t[e].open?t[e].open(n):y.showPopup(e)}),!0},y.showPopup=function(s){var i;return t[s].status>1&&(e?e===s?("function"==typeof t[s].onload&&t[s].onload(),i=!0):"function"==typeof t[e].onunload&&t[e].onunload()||(t[e].status--,o.find(">."+e).css("display",""),t[e].autoDestroy&&v(t[e],"popup",e),o.find(">."+s).css("display","block"),n.className=e=s,t[s].status++,"function"==typeof t[s].onload&&t[s].onload(),i=!0):(o.find(">."+s)[0].style.display=n.style.display="block",n.className=e=s,"function"==typeof y.popupEvents.onshow&&y.popupEvents.onshow({type:"show",id:e}),t[s].status++,"function"==typeof t[s].onload&&t[s].onload(),i=!0)),i},y.closePopup=function(s){var i;if(e&&(!s||e===s||"array"===$.type(s)&&s.indexOf(e)>=0)&&("function"!=typeof t[e].onunload||!t[e].onunload()))return t[e].status--,i=e,o.find(">."+e)[0].style.display=n.style.display=n.className=e="",t[i].autoDestroy&&v(t[i],"popup",e),"function"==typeof y.popupEvents.onhide&&y.popupEvents.onhide({type:"hide",id:i}),!0},y.getCurrentPopup=function(){return e},y.destroyPopup=function(e){if(2===t[e].status)return v(t[e],"popup",e),!0},y.popupEvents={},$(n).find(">div>a").on("click",y.closePopup.bind(y,undefined))}(),function(){var n,t,o=$("#photoview"),s=o.find(".close"),i=o.find(".prev"),a=o.find(".next"),r=o.find(".rotate.p"),c=o.find(".rotate.n"),l=e(o.find(">div")),u=[],d=[];function f(){var e=$(self);n=e.innerWidth(),t=e.innerHeight(),"number"==typeof l.current&&u[l.current]&&h(l.current)}function p(e){l.children[e].one("load",function(){u[e]={w:this.width,h:this.height},d[e]=0,l.current===e&&h(e),this.style.visibility="visible"})}function h(e){var o,s,i,a,r,c=d[e]%2;c?(a=u[e].h,r=u[e].w):(a=u[e].w,r=u[e].h),a>n||r>t?(n/t>(o=a/r)?s=(i=t)*o:i=(s=n)/o,c?(a=i,r=s):(a=s,r=i),l.children[e].css("cursor","zoom-in")):(a=u[e].w,r=u[e].h,l.children[e].css("cursor","")),l.children[e].css({top:(t-r)/2+"px",left:(n-a)/2+"px",width:a+"px",height:r+"px",transform:"rotate("+90*d[e]+"deg)"})}y.showPhotoView=function(e,n){var t;if("array"===$.type(e)){for(t=0;t<e.length;t++)l.add($('<img src="'+e[t]+'"/>')),p(t);n>=0&&n<l.children.length&&l.slideTo(n,!0),l.children.length>1?(i.css("display","block"),a.css("display","block")):(i.css("display",""),a.css("display",""))}},y.hidePhotoView=function(){for(u=[];l.children.length;)l.remove(0)},o.on("click",">div>img",function(){"zoom-in"===this.style.cursor?(d[l.current]%2?(this.style.top=u[l.current].w>t?(u[l.current].w-u[l.current].h)/2+"px":(t-u[l.current].h)/2+"px",this.style.left=u[l.current].h>n?(u[l.current].h-u[l.current].w)/2+"px":(n-u[l.current].w)/2+"px"):(this.style.top=u[l.current].h>t?0:(t-u[l.current].h)/2+"px",this.style.left=u[l.current].w>n?0:(n-u[l.current].w)/2+"px"),this.style.width=u[l.current].w+"px",this.style.height=u[l.current].h+"px",this.style.cursor="zoom-out"):"zoom-out"===this.style.cursor&&h(l.current)}),$(self).on("resize",f),i.on("click",function(){l.slideTo(l.current-1)}),a.on("click",function(){l.slideTo(l.current+1)}),r.on("click",function(){"number"==typeof d[l.current]&&(d[l.current]++,h(l.current))}),c.on("click",function(){"number"==typeof d[l.current]&&(d[l.current]--,h(l.current))}),s.on("click",y.hidePhotoView),l.onchange=function(){this.current===undefined?o.css("display",""):(u[this.current]&&h(this.current),o.css("display","block"))},"transform"in document.documentElement.style&&(r.css("display","block"),c.css("display","block")),f()}(),l=0,u=$("#hint"),d=$("#readable"),f=$("#dialog"),p=$("#loading"),h=[],y.showLoading=function(e){p.find(">div>div").text(e||s.loading),0===l&&p.css("display","block"),l+=1},y.hideLoading=function(){l>0&&0==(l-=1)&&(p.css("display",""),"function"==typeof y.dialogEvents.onloaded&&y.dialogEvents.onloaded({type:"loaded"}))},y.isLoading=function(){return l>0},y.hint=function(e,n,t){u[0].className=n||"",u.find("span").text(e),a?clearTimeout(a):(u.css("display","block"),u[0].offsetWidth,u.fadeIn()),t||(t="error"===n?4e3:"warning"===n?3e3:2e3),a=setTimeout(function(){a=0,u.fadeOut(function(){u.css("display","")})},t)},y.showReadable=function(e,n,t,o,s){d.prop("className",s||"").css("display","block").find(">div").css({width:n,height:t}).find(">div").append(e),c=o},y.hideReadable=function(){"function"==typeof c&&(c(),c=undefined),d.css("display","").find(">div>div>*").remove()},y.hideDialog=function(e){var n;"function"==typeof r&&("isConfirm"===f[0].className?r(e):"isAlert"===f[0].className&&r(),r=undefined),f[0].className="",h.length>0&&(n=h[0][0],h[0].shift(),y[n].apply(this,h[0]),h.shift())},y.showForeign=function(e,n,t,o){y.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+e+'"></iframe>',n,t,o,"foreign")},y.confirm=function(e,n,t){var o,i,a,c;""===f[0].className?(i=(o=f.find(">div")).find(">div>div"),a=o.find(">a.yes"),c=o.find(">a.no"),r=n,o.css("width",t||"400px"),"array"===$.type(e)?(i.text(e[0]),a.text(e[1]),c.text(e[2])):(i.text(e),a.text(s.yes),c.text(s.no)),f[0].className="isConfirm",o.css("height",i.outerHeight()+Math.max(a.outerHeight(),c.outerHeight())+76+"px")):h.push(["confirm",e,n,t])},y.alert=function(e,n,t){var o,s;""===f[0].className?(s=(o=f.find(">div")).find(">div>div"),r=n,o.css("width",t||"400px"),s.text(e),f[0].className="isAlert",o.css("height",s.outerHeight()+46+"px")):h.push(["alert",e,n,t])},d.find(">div>a").on("click",y.hideReadable),f.find(">div>a.close").on("click",y.hideDialog),f.find(">div>a.yes").on("click",function(){y.hideDialog(!0)}),f.find(">div>a.no").on("click",function(){y.hideDialog(!1)}),y.dialogEvents={},function(){var e;function t(t,o){(!t||t===e||"array"===$.type(t)&&t.indexOf(e)>=0)&&(o||m(),"function"==typeof n[e].onload&&n[e].onload(!0))}function o(){var t=history.state,o=y.parseHash(location.hash);history.replaceState&&history.replaceState(!0,null),y.location&&y.isSameLocation(y.location,o)||(y.lastLocation=y.location,y.location=o,y.lastLocation&&m(),"function"==typeof y.pageEvents.onroute&&y.pageEvents.onroute({type:"route",history:t}),x("page",n[o.id],o.id,function(s){var i;o.id!==e?(i=s||!t,e&&("function"==typeof n[e].onunload&&n[e].onunload(),n[e].status--,g("page",e).css("display",""),n[e].autoDestroy&&v(n[e],"popup",activePopup)),document.body.className=e=o.id,g("page",o.id).css("display","block"),n[o.id].status++,"function"==typeof n[o.id].onload&&n[o.id].onload(i)):"function"==typeof n[o.id].onload&&n[o.id].onload(),"function"==typeof y.pageEvents.onrouteend&&y.pageEvents.onrouteend({type:"routeend",history:t,force:i})}))}y.init=function(e){var t,s;if(n.hasOwnProperty(e))if(i){if(i!==e&&(s=i,i=e,y.location.id===s))return o(),!0}else if(i=e,"onhashchange"in self?$(self).on("hashchange",o):setInterval(function(){t!==location.hash&&(t=location.hash,o())},10),o(),y.location.args.hasOwnProperty("autopopup")){if(y.location.args.hasOwnProperty("autopopuparg"))try{t=JSON.parse(y.location.args.autopopuparg)}catch(a){}y.openPopup(y.location.args.autopopup,t)}},y.reloadPage=function(e,n){var o;y.isLoading()?(o=y.location,y.listeners.add(y.dialogEvents,"loaded",function s(i){y.listeners.remove(this,i.type,s);o===y.location&&t(e,n)})):t(e,n)},y.destroyPage=function(e){if(2===n[e].status)return v(n[e],"page",e),!0},y.pageEvents={}}(),y;function v(e,n,t){var o,s=n+"/"+t+"/";if("function"==typeof e.ondestroy&&e.ondestroy(),g(n,t).remove(),e.css&&"string"!=typeof e.css&&(e.css=y.removeCss(e.css).substr(require.toUrl(s).length)),e.js&&(s+=e.js,require.defined(s)&&(o=require(s),require.undef(s),o)))for(s in o)delete e[s];delete e.status}function g(e,n){var t="#"+e;return"popup"===e?t+=">div>div":"panel"===e&&(t+=">.contents>div"),n&&(t+=">."+n),$(t)}function x(e,n,t,o){var i,a,r,c,l;function u(){var s;"js"in n?(y.showLoading(),s=r+n.js,require([s],function(e){e&&Object.assign(n,e),n.status++,o(!0),y.hideLoading()},"dev"===VERSION?undefined:function(o){v(n,e,t),o.requireType&&"scripterror"!==o.requireType&&"nodefine"!==o.requireType||o.xhr&&404!==o.xhr.status?d(s,o.message):f(),y.hideLoading()})):(n.status++,o(!0))}function d(e,n){y.alert(s.error.replace("${res}",e)+n,l?function(){history.back()}:undefined)}function f(){l?location.reload():y.confirm(s.update,function(e){e&&location.reload()})}n.status>1?o():n.status||(n.status=1,a=g(e)[0],r=e+"/"+t+"/",c=require.toUrl(r),l="page"===e,"string"==typeof n.css&&(n.css=y.appendCss(c+n.css)),"html"in n?(i=c+n.html,$.ajax({url:i,type:"get",dataType:"text",success:function(e){a.insertAdjacentHTML("afterBegin",'<div class="'+t+'">'+e+"</div>"),u()},error:function(o){v(n,e,t),"dev"===VERSION||404!==o.status?d(i,o.status):f()},complete:y.hideLoading}),y.showLoading()):(a.insertAdjacentHTML("afterBegin",'<div class="'+t+'"></div>'),u()))}function m(){y.closePanel(),y.closePopup(),y.hideReadable()}});