"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels","./lang"],function(e,n,t,o,s){var i,a,r,c,d,l,u,f,h,y,v={appendCss:function(e){var n=document.createElement("link");return/\.less$/.test(e)?"object"===("undefined"==typeof less?"undefined":_typeof(less))?(n.rel="stylesheet/less",n.href=e,less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=e.replace(/less$/,"css")):(n.rel="stylesheet",n.href=e),(document.head||document.getElementsByTagName("head")[0]).appendChild(n)},removeCss:function(e){return $(e).remove(),"stylesheet/less"===e.rel&&(less.sheets.splice(less.sheets.indexOf(e),1),less.refresh()),e.getAttribute("href")},buildHash:function(e){var n,t="#!"+encodeURIComponent(e.id);for(n in e.args)t+=e.args[n]===undefined?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(e.args[n]);return t},parseHash:function(e){var t,o,s,a={id:i,args:{}};if((s=(e=e.substr(1).replace(/[#?].*$/,"")).match(/[^=&]+(=[^&]*)?/g))&&"!"===s[0].charAt(0))for(o=decodeURIComponent(s[0].substr(1)),n.hasOwnProperty(o)&&(a.id=o),t=1;t<s.length;t++)(o=s[t].match(/^([^=]+)(=)?(.+)?$/))&&(a.args[decodeURIComponent(o[1])]=o[2]?decodeURIComponent(o[3]||""):undefined);return a},isSameLocation:function(e,n){var t;if(e.id===n.id&&Object.keys(e.args).length===Object.keys(n.args).length){for(t in e.args){if(!n.args.hasOwnProperty(t))return!1;if(e.args[t]===undefined){if(e.args[t]!==n.args[t])return!1}else if(""+e.args[t]!=""+n.args[t])return!1}return!0}return!1},replaceLocation:function(e){v.location&&v.isSameLocation(e,v.location)?v.reloadPage():location.replace(v.buildHash(e))}};return function(){v.listeners={add:function(e,n,t){e.xEvents||(e.xEvents=function(n){!function(e,n){var t,o;for(e.xEvents[n.type].locked=!0,t=0;t<e.xEvents[n.type].length;t++)e.xEvents[n.type][t].call(e,n);e.xEvents[n.type].locked=!1;for(;e.xEvents[n.type].stack.length;)e.xEvents[n.type].stack[0]?(o=e.xEvents[n.type].indexOf(e.xEvents[n.type].stack[0][1]),e.xEvents[n.type].stack[0][0]?o>=0&&e.xEvents[n.type].splice(o,1):o<0&&e.xEvents[n.type].push(e.xEvents[n.type].stack[0][1])):e.xEvents[n.type].splice(0,e.xEvents[n.type].length),e.xEvents[n.type].stack.shift();e.xEvents[n.type].length||(delete e.xEvents[n.type],e["on"+n.type]=null);if(e.xEvents.removeMark){for(t in delete e.xEvents.removeMark,e.xEvents)delete e.xEvents[t],e["on"+t]=null;delete e.xEvents}}(e,n)}),e.xEvents[n]||(e.xEvents[n]=[],e.xEvents[n].stack=[],e.xEvents[n].locked=!1,e["on"+n]=e.xEvents),e.xEvents[n].locked?e.xEvents[n].stack.push([!1,t]):e.xEvents[n].indexOf(t)<0&&e.xEvents[n].push(t)},list:function(e,n){var t,o;if(n)t=e.xEvents&&e.xEvents[n]?e.xEvents[n].slice(0):[];else if(t={},e.xEvents)for(o in e.xEvents)"array"===$.type(e.xEvents[o])&&e.xEvents[o].length&&(t[o]=e.xEvents[o].slice(0));return t},remove:function(e,n,t){var o,s,i;if(e.xEvents)if(n)e.xEvents[n]&&(e.xEvents[n].locked?t?e.xEvents[n].stack.push([!0,t]):e.xEvents[n].stack.push(null):t?(i=e.xEvents[n].indexOf(t))>=0&&e.xEvents[n].splice(i,1):e.xEvents[n].splice(0,e.xEvents[n].length),0===e.xEvents[n].length&&(delete e.xEvents[n],e["on"+n]=null));else if(!e.xEvents.removeMark){for(o in e.xEvents)e.xEvents[o].locked?s=!0:(delete e.xEvents[o],e["on"+o]=null);s?e.xEvents.removeMark=!0:delete e.xEvents}}}}(),function(){var e,n,t,i=$("#panel"),a=i.find(">.contents>div");function r(e,o){n=!0,a.animate({"margin-left":o?"-100%":"0%"},{duration:200,complete:function(){n=!1,e(),"function"==typeof t&&(t(),t=undefined)}})}function c(){if("function"==typeof o[e].onunload&&o[e].onunload())return!0;o[e].status--,r(function(){"function"==typeof o[e].onunloadend&&o[e].onunloadend(),o[e].status--,a.find(">."+e)[0].style.display=i[0].style.display="",o[e].autoDestroy&&g(o[e],"panel",e),e=undefined},!1)}v.openPanel=function(e,n){var t=o[e];t?m("panel",t,e,function(o){"function"==typeof t.open?t.open(n):v.showPanel(e)}):v.hint(s.panelNotFound+e,"error")},v.showPanel=function(s){function d(){setTimeout(function(){t=v.showPanel.bind(this,s)},0)}n?d():e?e===s?("function"==typeof o[s].onload&&o[s].onload(),"function"==typeof o[s].onloadend&&o[s].onloadend()):c()||d():(o[s].status++,"function"==typeof o[s].onload&&o[s].onload(),i[0].className=e=s,i[0].style.display=a.find(">."+s)[0].style.display="block",r(function(){"function"==typeof o[s].onloadend&&o[s].onloadend(),o[s].status++},!0))},v.closePanel=function(o){if(n)setTimeout(function(){t=v.closePanel.bind(this,o)},0);else{if(e&&(!o||e===o||"array"===$.type(o)&&o.indexOf(e)>=0))return c();t&&(t=undefined)}},v.destroyPanel=function(e){if(o.hasOwnProperty(e)&&2===o[e].status)return g(o[e],"panel",e),!0},t=v.closePanel.bind(v,undefined),a.find(">.close").on("click",t),i.find(">.mask").on("click",t),t=undefined}(),function(){var e,n=document.getElementById("popup"),o=$(n).find(">div>div");v.openPopup=function(e,n){var o=t[e];o?m("popup",o,e,function(t){"function"==typeof o.open?o.open(n):v.showPopup(e)}):v.hint(s.popupNotFound+e,"error")},v.showPopup=function(s){if(e)if(e===s)"function"==typeof t[s].onload&&t[s].onload();else{if("function"!=typeof t[e].onunload||t[e].onunload())return!0;t[e].status--,o.find(">."+e).css("display",""),t[e].autoDestroy&&g(t[e],"popup",e),o.find(">."+s).css("display","block"),n.className=e=s,t[s].status++,"function"==typeof t[s].onload&&t[s].onload()}else o.find(">."+s)[0].style.display=n.style.display="block",n.className=e=s,"function"==typeof v.popupEvents.onshow&&v.popupEvents.onshow({type:"show",id:e}),t[s].status++,"function"==typeof t[s].onload&&t[s].onload()},v.closePopup=function(s){var i;if(e&&(!s||e===s||"array"===$.type(s)&&s.indexOf(e)>=0)){if("function"==typeof t[e].onunload&&t[e].onunload())return!0;t[e].status--,i=e,n.className=o.find(">."+e)[0].style.display=n.style.display=e="",t[i].autoDestroy&&g(t[i],"popup",e),"function"==typeof v.popupEvents.onhide&&v.popupEvents.onhide({type:"hide",id:i})}},v.getCurrentPopup=function(){return e},v.destroyPopup=function(e){if(t.hasOwnProperty(p)&&2===t[e].status)return g(t[e],"popup",e),!0},v.popupEvents={},$(n).find(">div>a").on("click",v.closePopup.bind(v,undefined))}(),function(){var n,t,o=$("#photoview"),s=o.find(".close"),i=o.find(".prev"),a=o.find(".next"),r=o.find(".rotate.p"),c=o.find(".rotate.n"),d=e(o.find(">div")),l=[],u=[];function f(){var e=$(self);n=e.innerWidth(),t=e.innerHeight(),"number"==typeof d.current&&l[d.current]&&h(d.current)}function p(e){d.children[e].one("load",function(){l[e]={w:this.width,h:this.height},u[e]=0,d.current===e&&h(e),this.style.visibility="visible"})}function h(e){var o,s,i,a,r,c=u[e]%2;c?(a=l[e].h,r=l[e].w):(a=l[e].w,r=l[e].h),a>n||r>t?(n/t>(o=a/r)?s=(i=t)*o:i=(s=n)/o,c?(a=i,r=s):(a=s,r=i),d.children[e].css("cursor","zoom-in")):(a=l[e].w,r=l[e].h,d.children[e].css("cursor","")),d.children[e].css({top:(t-r)/2+"px",left:(n-a)/2+"px",width:a+"px",height:r+"px",transform:"rotate("+90*u[e]+"deg)"})}v.showPhotoView=function(e,n){var t;if("array"===$.type(e)){for(t=0;t<e.length;t++)d.add($('<img src="'+e[t]+'"/>')),p(t);n>=0&&n<d.children.length&&d.slideTo(n,!0),d.children.length>1?(i.css("display","block"),a.css("display","block")):(i.css("display",""),a.css("display",""))}},v.hidePhotoView=function(){for(l=[];d.children.length;)d.remove(0)},o.on("click",">div>img",function(){"zoom-in"===this.style.cursor?(u[d.current]%2?(this.style.top=l[d.current].w>t?(l[d.current].w-l[d.current].h)/2+"px":(t-l[d.current].h)/2+"px",this.style.left=l[d.current].h>n?(l[d.current].h-l[d.current].w)/2+"px":(n-l[d.current].w)/2+"px"):(this.style.top=l[d.current].h>t?0:(t-l[d.current].h)/2+"px",this.style.left=l[d.current].w>n?0:(n-l[d.current].w)/2+"px"),this.style.width=l[d.current].w+"px",this.style.height=l[d.current].h+"px",this.style.cursor="zoom-out"):"zoom-out"===this.style.cursor&&h(d.current)}),$(self).on("resize",f),i.on("click",function(){d.slideTo(d.current-1)}),a.on("click",function(){d.slideTo(d.current+1)}),r.on("click",function(){"number"==typeof u[d.current]&&(u[d.current]++,h(d.current))}),c.on("click",function(){"number"==typeof u[d.current]&&(u[d.current]--,h(d.current))}),s.on("click",v.hidePhotoView),d.onchange=function(){this.current===undefined?o.css("display",""):(l[this.current]&&h(this.current),o.css("display","block"))},"transform"in document.documentElement.style&&(r.css("display","block"),c.css("display","block")),f()}(),d=0,l=$("#hint"),u=$("#readable"),f=$("#dialog"),h=$("#loading"),y=[],v.showLoading=function(e){h.find(">div>div").text(e||s.loading),0===d&&h.css("display","block"),d+=1},v.hideLoading=function(){d>0&&0==(d-=1)&&(h.css("display",""),"function"==typeof v.dialogEvents.onloaded&&v.dialogEvents.onloaded({type:"loaded"}))},v.isLoading=function(){return d>0},v.hint=function(e,n,t){l[0].className=n||"",l.find("span").text(e),a?clearTimeout(a):(l.css("display","block"),l[0].offsetWidth,l.fadeIn()),t||(t="error"===n?4e3:"warning"===n?3e3:2e3),a=setTimeout(function(){a=0,l.fadeOut(function(){l.css("display","")})},t)},v.showReadable=function(e,n,t,o,s){u.prop("className",s||"").css("display","block").find(">div").css({width:n,height:t}).find(">div").append(e),c=o},v.hideReadable=function(){"function"==typeof c&&(c(),c=undefined),u.css("display","").find(">div>div>*").remove()},v.hideDialog=function(e){var n;"function"==typeof r&&("isConfirm"===f[0].className?r(e):"isAlert"===f[0].className&&r(),r=undefined),f[0].className="",y.length>0&&(n=y[0][0],y[0].shift(),v[n].apply(this,y[0]),y.shift())},v.showForeign=function(e,n,t,o){v.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+e+'"></iframe>',n,t,o,"foreign")},v.confirm=function(e,n,t){var o,i,a,c;""===f[0].className?(i=(o=f.find(">div")).find(">div>div"),a=o.find(">a.yes"),c=o.find(">a.no"),r=n,o.css("width",t||"400px"),"array"===$.type(e)?(i.text(e[0]),a.text(e[1]),c.text(e[2])):(i.text(e),a.text(s.yes),c.text(s.no)),f[0].className="isConfirm",o.css("height",i.outerHeight()+Math.max(a.outerHeight(),c.outerHeight())+76+"px")):y.push(["confirm",e,n,t])},v.alert=function(e,n,t){var o,s;""===f[0].className?(s=(o=f.find(">div")).find(">div>div"),r=n,o.css("width",t||"400px"),s.text(e),f[0].className="isAlert",o.css("height",s.outerHeight()+46+"px")):y.push(["alert",e,n,t])},u.find(">div>a").on("click",v.hideReadable),f.find(">div>a.close").on("click",v.hideDialog),f.find(">div>a.yes").on("click",function(){v.hideDialog(!0)}),f.find(">div>a.no").on("click",function(){v.hideDialog(!1)}),v.dialogEvents={},function(){var e;function t(t,o){(!t||t===e||"array"===$.type(t)&&t.indexOf(e)>=0)&&(o||b(),"function"==typeof n[e].onload&&n[e].onload(!0))}function o(){var t=history.state,o=v.parseHash(location.hash);history.replaceState&&history.replaceState(!0,null),v.location&&v.isSameLocation(v.location,o)||(v.lastLocation=v.location,v.location=o,v.lastLocation&&b(),"function"==typeof v.pageEvents.onroute&&v.pageEvents.onroute({type:"route"}),m("page",n[o.id],o.id,function(s){var i;o.id!==e?(i=s||!t,e?("function"==typeof n[e].onunload&&n[e].onunload(),n[e].status--,x("page",e).css("display",""),n[e].autoDestroy&&g(n[e],"popup",activePopup)):o.args.hasOwnProperty("autopopup")&&v.openPopup(o.args.autopopup,o.args.autopopuparg?JSON.parse(o.args.autopopuparg):undefined),document.body.className=e=o.id,x("page",o.id).css("display","block"),n[o.id].status++,"function"==typeof n[o.id].onload&&n[o.id].onload(i)):"function"==typeof n[o.id].onload&&n[o.id].onload(),"function"==typeof v.pageEvents.onroutend&&v.pageEvents.onroutend({type:"routend",force:i})}))}v.init=function(e){var t;if(n.hasOwnProperty(e)){if(!i)return i=e,"onhashchange"in self?$(self).on("hashchange",o):setInterval(function(){t!==location.hash&&(t=location.hash,o())},10),o(),!0;if(t=i,i=e,v.location&&v.location.id===t&&!v.isSameLocation(v.location,v.parseHash(location.hash)))return o(),!0}},v.reloadPage=function(e,n){var o;v.isLoading()?(o=v.location,v.listeners.add(v.dialogEvents,"loaded",function s(i){v.listeners.remove(this,i.type,s);o===v.location&&t(e,n)})):t(e,n)},v.destroyPage=function(e){if(n.hasOwnProperty(e)&&2===n[e].status)return g(n[e],"page",e),!0},v.pageEvents={}}(),v;function g(e,n,t){var o,s=n+"/"+t+"/";if("function"==typeof e.ondestroy&&e.ondestroy(),x(n,t).remove(),e.css&&"string"!=typeof e.css&&(e.css=v.removeCss(e.css).substr(require.toUrl(s).length)),e.js&&(s+=e.js,require.defined(s)&&(o=require(s),require.undef(s),o)))for(s in o)delete e[s];delete e.status}function x(e,n){var t="#"+e;return"popup"===e?t+=">div>div":"panel"===e&&(t+=">.contents>div"),n&&(t+=">."+n),$(t)}function m(e,n,t,o){if(n.status>1)o();else if(!n.status){n.status=1;var s,i=x(e)[0],a=e+"/"+t+"/",r=require.toUrl(a),c="page"===e;"string"==typeof n.css&&(n.css=v.appendCss(r+n.css)),"html"in n?(s=r+n.html,$.ajax({url:s,type:"get",dataType:"text",success:function(e){i.insertAdjacentHTML("afterBegin",'<div class="'+t+'">'+e+"</div>"),d()},error:function(o,i){g(n,e,t),"dev"===VERSION||404!==o.status?E(s,o.status,c):k(c)},complete:v.hideLoading}),v.showLoading()):(i.insertAdjacentHTML("afterBegin",'<div class="'+t+'"></div>'),d())}function d(){var s;"js"in n?(v.showLoading(),s=a+n.js,require([s],function(e){e&&Object.assign(n,e),n.status++,o(!0),v.hideLoading()},"dev"===VERSION?undefined:function(o){g(n,e,t),o.requireType&&"scripterror"!==o.requireType&&"nodefine"!==o.requireType||o.xhr&&404!==o.xhr.status?E(s,o.message,c):k(c),v.hideLoading()})):(n.status++,o(!0))}}function E(e,n,t){v.alert(s.error.replace("${res}",e)+n,t?function(){history.back()}:undefined)}function k(e){e?location.reload():v.confirm(s.update,function(e){e&&location.reload()})}function b(){v.closePanel(),v.closePopup(),v.hideReadable()}});