"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels","./lang"],function(e,n,t,o,s){var i,a,r,c,u,d,l,p,f,h,y={appendCss:function(e){var n=document.createElement("link");return/\.less$/.test(e)?"object"===("undefined"==typeof less?"undefined":_typeof(less))?(n.rel="stylesheet/less",n.href=e,less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=e.replace(/less$/,"css")):(n.rel="stylesheet",n.href=e),(document.head||document.getElementsByTagName("head")[0]).appendChild(n)},removeCss:function(e){return $(e).remove(),"stylesheet/less"===e.rel&&(less.sheets.splice(less.sheets.indexOf(e),1),less.refresh()),e.getAttribute("href")},buildHash:function(e){var n,t="#!"+encodeURIComponent(e.id);for(n in e.args)t+=e.args[n]===undefined?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(e.args[n]);return t},parseHash:function(e){var t,o,s,a={id:i,args:{}};if((s=(e=e.substr(1).replace(/[#?].*$/,"")).match(/[^=&]+(=[^&]*)?/g))&&"!"===s[0].charAt(0))for(o=decodeURIComponent(s[0].substr(1)),n.hasOwnProperty(o)&&(a.id=o),t=1;t<s.length;t++)(o=s[t].match(/^([^=]+)(=)?(.+)?$/))&&(a.args[decodeURIComponent(o[1])]=o[2]?decodeURIComponent(o[3]||""):undefined);return a},isSameLocation:function(e,n){var t;if(e.id===n.id&&Object.keys(e.args).length===Object.keys(n.args).length){for(t in e.args){if(!n.args.hasOwnProperty(t))return!1;if(e.args[t]===undefined){if(e.args[t]!==n.args[t])return!1}else if(""+e.args[t]!=""+n.args[t])return!1}return!0}return!1},replaceLocation:function(e){y.location&&y.isSameLocation(e,y.location)?y.reloadPage():location.replace(y.buildHash(e))},getLang:function(e){if(navigator.languages){for(var n=0;n<navigator.languages.length;n++)if(e.hasOwnProperty(navigator.languages[n]))return e[navigator.languages[n]]}else if(e.hasOwnProperty(navigator.language))return e[navigator.language];return e.en}};return s=y.getLang(s),function(){function e(e){var t;for(this.xEvents[e.type].locked=!0,t=0;t<this.xEvents[e.type].heap.length;t++)this.xEvents[e.type].heap[t].call(this,e);for(this.xEvents[e.type].locked=!1;this.xEvents[e.type].stack.length;)this.xEvents[e.type].stack[0]?"function"==typeof this.xEvents[e.type].stack[0]?(t=this.xEvents[e.type].heap.indexOf(this.xEvents[e.type].stack[0]))>=0&&this.xEvents[e.type].heap.splice(t,1):this.xEvents[e.type].heap.indexOf(this.xEvents[e.type].stack[0][0])<0&&this.xEvents[e.type].heap.push(this.xEvents[e.type].stack[0][0]):this.xEvents[e.type].heap.splice(0),this.xEvents[e.type].stack.shift();n(this,e.type)}function n(e,n,t){!t&&e.xEvents[n].heap.length||(delete e.xEvents[n],e["on"+n]=null)}y.listeners={add:function(n,t,o){var s=0;return"function"==typeof o&&(n.hasOwnProperty("xEvents")||(n.xEvents={}),n.xEvents.hasOwnProperty(t)||(n.xEvents[t]={stack:[],heap:[],locked:!1},n["on"+t]=e),n.xEvents[t].locked?(n.xEvents[t].stack.push([o]),s=2):n.xEvents[t].heap.indexOf(o)<0&&(n.xEvents[t].heap.push(o),s=1)),s},list:function(e,n){var t,o;if(n)o=e.hasOwnProperty("xEvents")&&e.xEvents.hasOwnProperty(n)?e.xEvents[n].heap.slice(0):[];else if(o={},e.hasOwnProperty("xEvents"))for(t in e.xEvents)o[t]=e.xEvents[t].heap.slice(0);return o},remove:function(e,t,o){var s,i=0;if(e.hasOwnProperty("xEvents"))if(t)e.xEvents.hasOwnProperty(t)&&(e.xEvents[t].locked?(e.xEvents[t].stack.push(o),i=2):"function"==typeof o?(s=e.xEvents[t].heap.indexOf(o))>=0&&(e.xEvents[t].heap.splice(s,1),n(e,t),i=1):(n(e,t,!0),i=1));else{for(s in e.xEvents)e.xEvents[s].locked?(e.xEvents[s].stack.push(undefined),i=2):n(e,s,!0);i||(i=1)}return i}}}(),function(){var e,n,t,s=$("#panel"),i=s.find(">.contents>div");function a(e,o){n=!0,i.animate({"margin-left":o?"-100%":"0%"},{duration:200,complete:function(){var o;n=!1,e(),"function"==typeof t&&(o=t,t=undefined,o())}})}function r(){if("function"!=typeof o[e].onunload||!o[e].onunload())return o[e].status--,a(function(){"function"==typeof o[e].onunloadend&&o[e].onunloadend(),o[e].status--,i.find(">."+e)[0].style.display=s[0].style.display="",o[e].autoDestroy&&v(o[e],"panel",e),e=undefined},!1),!0}y.openPanel=function(e,n){if(o.hasOwnProperty(e))return m("panel",o[e],e,function(){"function"==typeof o[e].open?o[e].open(n):y.showPanel(e)}),!0},y.showPanel=function(c){var u=0;return o[c].status>1&&(n?(t=y.showPanel.bind(this,c),u=2):e?e===c?("function"==typeof o[c].onload&&o[c].onload(),"function"==typeof o[c].onloadend&&o[c].onloadend(),u=1):r()&&(t=y.showPanel.bind(this,c),u=1):(o[c].status++,"function"==typeof o[c].onload&&o[c].onload(),s[0].className=e=c,s[0].style.display=i.find(">."+c)[0].style.display="block",a(function(){"function"==typeof o[c].onloadend&&o[c].onloadend(),o[c].status++},!0),u=1)),u},y.closePanel=function(o){var s=0;return n?(t=y.closePanel.bind(this,o),s=2):e&&(!o||e===o||"array"===$.type(o)&&o.indexOf(e)>=0)&&r()&&(s=1),s},y.destroyPanel=function(e){if(2===o[e].status)return v(o[e],"panel",e),!0},t=y.closePanel.bind(y,undefined),i.find(">.close").on("click",t),s.find(">.mask").on("click",t),t=undefined}(),function(){var e,n=document.getElementById("popup"),o=$(n).find(">div>div");y.openPopup=function(e,n){if(t.hasOwnProperty(e))return m("popup",t[e],e,function(){"function"==typeof t[e].open?t[e].open(n):y.showPopup(e)}),!0},y.showPopup=function(s){var i;return t[s].status>1&&(e?e===s?("function"==typeof t[s].onload&&t[s].onload(),i=!0):"function"==typeof t[e].onunload&&t[e].onunload()||(t[e].status--,o.find(">."+e).css("display",""),t[e].autoDestroy&&v(t[e],"popup",e),o.find(">."+s).css("display","block"),n.className=e=s,t[s].status++,"function"==typeof t[s].onload&&t[s].onload(),i=!0):(o.find(">."+s)[0].style.display=n.style.display="block",n.className=e=s,"function"==typeof y.popupEvents.onshow&&y.popupEvents.onshow({type:"show",id:e}),t[s].status++,"function"==typeof t[s].onload&&t[s].onload(),i=!0)),i},y.closePopup=function(s){var i;if(e&&(!s||e===s||"array"===$.type(s)&&s.indexOf(e)>=0)&&("function"!=typeof t[e].onunload||!t[e].onunload()))return t[e].status--,i=e,o.find(">."+e)[0].style.display=n.style.display=n.className=e="",t[i].autoDestroy&&v(t[i],"popup",e),"function"==typeof y.popupEvents.onhide&&y.popupEvents.onhide({type:"hide",id:i}),!0},y.getCurrentPopup=function(){return e},y.destroyPopup=function(e){if(2===t[e].status)return v(t[e],"popup",e),!0},y.popupEvents={},$(n).find(">div>a").on("click",y.closePopup.bind(y,undefined))}(),function(){var n,t,o=$("#photoview"),s=o.find(".close"),i=o.find(".prev"),a=o.find(".next"),r=o.find(".rotate.p"),c=o.find(".rotate.n"),u=e(o.find(">div")),d=[],l=[];function p(){var e=$(self);n=e.innerWidth(),t=e.innerHeight(),"number"==typeof u.current&&d[u.current]&&h(u.current)}function f(e){u.children[e].one("load",function(){d[e]={w:this.width,h:this.height},l[e]=0,u.current===e&&h(e),this.style.visibility="visible"})}function h(e){var o,s,i,a,r,c=l[e]%2;c?(a=d[e].h,r=d[e].w):(a=d[e].w,r=d[e].h),a>n||r>t?(n/t>(o=a/r)?s=(i=t)*o:i=(s=n)/o,c?(a=i,r=s):(a=s,r=i),u.children[e].css("cursor","zoom-in")):(a=d[e].w,r=d[e].h,u.children[e].css("cursor","")),u.children[e].css({top:(t-r)/2+"px",left:(n-a)/2+"px",width:a+"px",height:r+"px",transform:"rotate("+90*l[e]+"deg)"})}y.showPhotoView=function(e,n){var t;if("array"===$.type(e)){for(t=0;t<e.length;t++)u.add($('<img src="'+e[t]+'"/>')),f(t);n>=0&&n<u.children.length&&u.slideTo(n,!0),u.children.length>1?(i.css("display","block"),a.css("display","block")):(i.css("display",""),a.css("display",""))}},y.hidePhotoView=function(){for(d=[];u.children.length;)u.remove(0)},o.on("click",">div>img",function(){"zoom-in"===this.style.cursor?(l[u.current]%2?(this.style.top=d[u.current].w>t?(d[u.current].w-d[u.current].h)/2+"px":(t-d[u.current].h)/2+"px",this.style.left=d[u.current].h>n?(d[u.current].h-d[u.current].w)/2+"px":(n-d[u.current].w)/2+"px"):(this.style.top=d[u.current].h>t?0:(t-d[u.current].h)/2+"px",this.style.left=d[u.current].w>n?0:(n-d[u.current].w)/2+"px"),this.style.width=d[u.current].w+"px",this.style.height=d[u.current].h+"px",this.style.cursor="zoom-out"):"zoom-out"===this.style.cursor&&h(u.current)}),$(self).on("resize",p),i.on("click",function(){u.slideTo(u.current-1)}),a.on("click",function(){u.slideTo(u.current+1)}),r.on("click",function(){"number"==typeof l[u.current]&&(l[u.current]++,h(u.current))}),c.on("click",function(){"number"==typeof l[u.current]&&(l[u.current]--,h(u.current))}),s.on("click",y.hidePhotoView),u.onchange=function(){this.current===undefined?o.css("display",""):(d[this.current]&&h(this.current),o.css("display","block"))},"transform"in document.documentElement.style&&(r.css("display","block"),c.css("display","block")),p()}(),u=0,d=$("#hint"),l=$("#readable"),p=$("#dialog"),f=$("#loading"),h=[],y.showLoading=function(e){f.find(">div>div").text(e||s.loading),0===u&&f.css("display","block"),u+=1},y.hideLoading=function(){u>0&&0==(u-=1)&&(f.css("display",""),"function"==typeof y.dialogEvents.onloaded&&y.dialogEvents.onloaded({type:"loaded"}))},y.isLoading=function(){return u>0},y.hint=function(e,n,t){d[0].className=n||"",d.find("span").text(e),a?clearTimeout(a):(d.css("display","block"),d[0].offsetWidth,d.fadeIn()),t||(t="error"===n?4e3:"warning"===n?3e3:2e3),a=setTimeout(function(){a=0,d.fadeOut(function(){d.css("display","")})},t)},y.showReadable=function(e,n,t,o,s){l.prop("className",s||"").css("display","block").find(">div").css({width:n,height:t}).find(">div").append(e),c=o},y.hideReadable=function(){"function"==typeof c&&(c(),c=undefined),l.css("display","").find(">div>div>*").remove()},y.hideDialog=function(e){var n;"function"==typeof r&&("isConfirm"===p[0].className?r(e):"isAlert"===p[0].className&&r(),r=undefined),p[0].className="",h.length>0&&(n=h[0][0],h[0].shift(),y[n].apply(this,h[0]),h.shift())},y.showForeign=function(e,n,t,o){y.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+e+'"></iframe>',n,t,o,"foreign")},y.confirm=function(e,n,t){var o,i,a,c;""===p[0].className?(i=(o=p.find(">div")).find(">div>div"),a=o.find(">a.yes"),c=o.find(">a.no"),r=n,o.css("width",t||"400px"),"array"===$.type(e)?(i.text(e[0]),a.text(e[1]),c.text(e[2])):(i.text(e),a.text(s.yes),c.text(s.no)),p[0].className="isConfirm",o.css("height",i.outerHeight()+Math.max(a.outerHeight(),c.outerHeight())+76+"px")):h.push(["confirm",e,n,t])},y.alert=function(e,n,t){var o,s;""===p[0].className?(s=(o=p.find(">div")).find(">div>div"),r=n,o.css("width",t||"400px"),s.text(e),p[0].className="isAlert",o.css("height",s.outerHeight()+46+"px")):h.push(["alert",e,n,t])},l.find(">div>a").on("click",y.hideReadable),p.find(">div>a.close").on("click",y.hideDialog),p.find(">div>a.yes").on("click",function(){y.hideDialog(!0)}),p.find(">div>a.no").on("click",function(){y.hideDialog(!1)}),y.dialogEvents={},function(){var e;function t(t,o){(!t||t===e||"array"===$.type(t)&&t.indexOf(e)>=0)&&(o||x(),"function"==typeof n[e].onload&&n[e].onload(!0))}function o(){var t=history.state,o=y.parseHash(location.hash);history.replaceState&&history.replaceState(!0,null),y.location&&y.isSameLocation(y.location,o)||(y.lastLocation=y.location,y.location=o,y.lastLocation&&x(),"function"==typeof y.pageEvents.onroute&&y.pageEvents.onroute({type:"route",history:t}),m("page",n[o.id],o.id,function(s){var i;o.id!==e?(i=s||!t,e&&("function"==typeof n[e].onunload&&n[e].onunload(),n[e].status--,g("page",e).css("display",""),n[e].autoDestroy&&v(n[e],"popup",activePopup)),document.body.className=e=o.id,g("page",o.id).css("display","block"),n[o.id].status++,"function"==typeof n[o.id].onload&&n[o.id].onload(i)):"function"==typeof n[o.id].onload&&n[o.id].onload(),"function"==typeof y.pageEvents.onrouteend&&y.pageEvents.onrouteend({type:"routeend",history:t,force:i})}))}y.init=function(e){var t,s;if(n.hasOwnProperty(e))if(i){if(i!==e&&(s=i,i=e,y.location.id===s))return o(),!0}else if(i=e,"onhashchange"in self?$(self).on("hashchange",o):setInterval(function(){t!==location.hash&&(t=location.hash,o())},10),o(),y.location.args.hasOwnProperty("autopopup")){if(y.location.args.hasOwnProperty("autopopuparg"))try{t=JSON.parse(y.location.args.autopopuparg)}catch(a){}y.openPopup(y.location.args.autopopup,t)}},y.reloadPage=function(e,n){var o;y.isLoading()?(o=y.location,y.listeners.add(y.dialogEvents,"loaded",function s(i){y.listeners.remove(this,i.type,s);o===y.location&&t(e,n)})):t(e,n)},y.destroyPage=function(e){if(2===n[e].status)return v(n[e],"page",e),!0},y.pageEvents={}}(),y;function v(e,n,t){var o,s=n+"/"+t+"/";if("function"==typeof e.ondestroy&&e.ondestroy(),g(n,t).remove(),e.css&&"string"!=typeof e.css&&(e.css=y.removeCss(e.css).substr(require.toUrl(s).length)),e.js&&(s+=e.js,require.defined(s)&&(o=require(s),require.undef(s),o)))for(s in o)delete e[s];delete e.status}function g(e,n){var t="#"+e;return"popup"===e?t+=">div>div":"panel"===e&&(t+=">.contents>div"),n&&(t+=">."+n),$(t)}function m(e,n,t,o){var i,a,r,c,u;function d(){var s;"js"in n?(y.showLoading(),s=r+n.js,require([s],function(e){e&&Object.assign(n,e),n.status++,o(!0),y.hideLoading()},"dev"===VERSION?undefined:function(o){v(n,e,t),o.requireType&&"scripterror"!==o.requireType&&"nodefine"!==o.requireType||o.xhr&&404!==o.xhr.status?l(s,o.message):p(),y.hideLoading()})):(n.status++,o(!0))}function l(e,n){y.alert(s.error.replace("${res}",e)+n,u?function(){history.back()}:undefined)}function p(){u?location.reload():y.confirm(s.update,function(e){e&&location.reload()})}n.status>1?o():n.status||(n.status=1,a=g(e)[0],r=e+"/"+t+"/",c=require.toUrl(r),u="page"===e,"string"==typeof n.css&&(n.css=y.appendCss(c+n.css)),"html"in n?(i=c+n.html,$.ajax({url:i,type:"get",dataType:"text",success:function(e){a.insertAdjacentHTML("afterBegin",'<div class="'+t+'">'+e+"</div>"),d()},error:function(o){v(n,e,t),"dev"===VERSION||404!==o.status?l(i,o.status):p()},complete:y.hideLoading}),y.showLoading()):(a.insertAdjacentHTML("afterBegin",'<div class="'+t+'"></div>'),d()))}function x(){y.closePanel(),y.closePopup(),y.hideReadable()}});