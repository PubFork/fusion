"use strict";define("common/kernel/kernel",["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels"],function(e,n,t,o){function i(e,n,t,o){function i(){var e;"js"in n?(l.showLoading(),e=r+n.js,require([e],function(e){delete n.js,e&&l.extendIn(n,e,c),n.loaded=2,o(),l.hideLoading()},require.data.debug?void 0:function(t){n.loaded=0,t.requireType&&"scripterror"!==t.requireType&&"nodefine"!==t.requireType||t.xhr&&404!==t.xhr.status?(require.undef(e),s(e,t.message,p)):a(p),l.hideLoading()})):(n.loaded=2,o())}var d,c,r,u,p,f;2===n.loaded?o():1!==n.loaded&&(n.loaded=1,d="#"+e+"s",c=["onload","onunload"],r=e+"/"+t+"/",u=require.toUrl(r),p="page"===e,p||(c.push("open"),"popup"===e?d+=">div>div":"panel"===e&&(c.push("onloadend"),c.push("onunloadend"),d+=">.contents>div")),d=$(d)[0],"css"in n&&(l.appendCss(u+n.css),delete n.css),"html"in n?(f=u+n.html,$.ajax({url:f,type:"get",dataType:"text",success:function(e){delete n.html,d.insertAdjacentHTML("afterBegin",'<div id="'+t+'">'+e+"</div>"),i()},error:function(e,t){n.loaded=0,require.data.debug||404!==e.status?s(f,e.status,p):a(p)},complete:l.hideLoading}),l.showLoading()):(d.insertAdjacentHTML("afterBegin",'<div id="'+t+'"></div>'),i()))}function s(e,n,t){l.alert("加载"+e+"时发生了一个错误: "+n,t?function(){history.back()}:void 0)}function a(e){e?location.reload():l.confirm("网站已经更新, 使用该功能需要先重新加载. 是否立即刷新本页?",function(e){e&&location.reload()})}var d,l={appendCss:function(e){var n=document.createElement("link");n.type="text/css",/\.less$/.test(e)?"object"==typeof less?(n.rel="stylesheet/less",n.href=e,less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=e.replace(/less$/,"css")):(n.rel="stylesheet",n.href=e),(document.head||document.getElementsByTagName("head")[0]).appendChild(n)},extendIn:function(e,n,t){for(var o=0;o<t.length;o++)t[o]in n&&(e[t[o]]=n[t[o]])},buildHash:function(e){var n,t="#!"+encodeURIComponent(e.id);for(n in e.args)t+=void 0===e.args[n]?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(e.args[n]);return t},parseHash:function(e){var t,o,i,s={id:d,args:{}};if(e=e.substr(1).replace(/[#\?].*$/,""),i=e.match(/[^=&]+(=[^&]*)?/g)){"!"===i[0].charAt(0)&&(o=i[0].substr(1),o in n&&(s.id=decodeURIComponent(o)));for(t=1;t<i.length;t++)o=i[t].match(/^([^=]+)(=)?(.+)?$/),o&&(s.args[decodeURIComponent(o[1])]=o[2]?decodeURIComponent(o[3]||""):void 0)}return s},isSameLocation:function(e,n){var t;if(e.id===n.id&&Object.keys(e.args).length===Object.keys(n.args).length){for(t in e.args)if(!(t in n.args)||e.args[t]!==n.args[t])return!1;return!0}return!1}};return!function(){function e(e,n){var t,o,i;for(e.xEvents[n.type].locked=!0,t=0;t<e.xEvents[n.type].length;t++)e.xEvents[n.type][t].call(e,n);for(e.xEvents[n.type].locked=!1;e.xEvents[n.type].stack.length;)e.xEvents[n.type].stack[0]?(o=e.xEvents[n.type].indexOf(e.xEvents[n.type].stack[0][1]),e.xEvents[n.type].stack[0][0]?-1!==o&&e.xEvents[n.type].splice(o,1):-1===o&&e.xEvents[n.type].push(e.xEvents[n.type].stack[0][1])):e.xEvents[n.type].splice(0,e.xEvents[n.type].length),e.xEvents[n.type].stack.shift();if(e.xEvents[n.type].length||(delete e.xEvents[n.type],e["on"+n.type]=null),e.xEvents.removeMark){delete e.xEvents.removeMark;for(i in e.xEvents)delete e.xEvents[i],e["on"+i]=null;e.xEvents=null}}l.listeners={add:function(n,t,o){n.xEvents||(n.xEvents=function(t){e(n,t)}),n.xEvents[t]||(n.xEvents[t]=[],n.xEvents[t].stack=[],n.xEvents[t].locked=!1,n["on"+t]=n.xEvents),n.xEvents[t].locked?n.xEvents[t].stack.push([!1,o]):n.xEvents[t].indexOf(o)<0&&n.xEvents[t].push(o)},list:function(e,n){var t,o;if(n)t=e.xEvents&&e.xEvents[n]?e.xEvents[n].slice(0):[];else if(t={},e.xEvents)for(o in e.xEvents)"array"===$.type(e.xEvents[o])&&e.xEvents[o].length&&(t[o]=e.xEvents[o].slice(0));return t},remove:function(e,n,t){var o,i,s;if(e.xEvents)if(n)e.xEvents[n]&&(e.xEvents[n].locked?t?e.xEvents[n].stack.push([!0,t]):e.xEvents[n].stack.push(null):t?(s=e.xEvents[n].indexOf(t),-1!==s&&e.xEvents[n].splice(s,1)):e.xEvents[n].splice(0,e.xEvents[n].length),0===e.xEvents[n].length&&(delete e.xEvents[n],e["on"+n]=null));else if(!e.xEvents.removeMark){for(o in e.xEvents)e.xEvents[o].locked?i=!0:(delete e.xEvents[o],e["on"+o]=null);i?e.xEvents.removeMark=!0:e.xEvents=null}}}}(),!function(){function e(e,n){s=!0,$(c).animate({"margin-left":n?"-100%":"0%"},{duration:200,complete:function(){s=!1,e(),"function"==typeof a&&(a(),a=void 0)}})}function n(){"function"==typeof o[t].onunload&&o[t].onunload(),e(function(){"function"==typeof o[t].onunloadend&&o[t].onunloadend(),document.getElementById(t).style.display=d.style.display="",t=void 0},!1)}var t,s,a,d=document.getElementById("panels"),c=d.lastChild.firstChild;l.openPanel=function(e,n){var t=o[e];t?i("panel",t,e,function(){"function"==typeof t.open?t.open(n):l.showPanel(e,n)}):l.hint("panel config not found: "+e,"error")},l.showPanel=function(i,c){function r(){setTimeout(function(){a=function(){l.showPanel(i,c)}},0)}s?r():t?(n(),r()):("function"==typeof o[i].onload&&o[i].onload(c),d.className=t=i,d.style.display=document.getElementById(i).style.display="block",e(function(){"function"==typeof o[i].onloadend&&o[i].onloadend()},!0))},l.closePanel=function(e){var o;s?setTimeout(function(){a=function(){l.closePanel(e)}},0):t&&(o="string"==typeof e?e===t:"array"===$.type(e)?e.indexOf(t)>=0:!0,o?n():a&&(a=void 0))},$(d.firstChild).on("click",l.closePanel),$(c.firstChild).on("click",l.closePanel)}(),!function(){var e,n=document.getElementById("popups");l.openPopup=function(e,n){var o=t[e];o?i("popup",o,e,function(){"function"==typeof o.open?o.open(n):l.showPopup(e,n)}):l.hint("popup config not found: "+e,"error")},l.showPopup=function(o,i){var s,a=t[o];e?("function"==typeof t[e].onunload&&t[e].onunload(),document.getElementById(e).style.display=""):(n.style.display="block",s=!0),e=o,n.className=o,document.getElementById(o).style.display="block",s&&"function"==typeof l.popupEvents.onshow&&l.popupEvents.onshow({type:"show"}),"function"==typeof a.onload&&a.onload(i)},l.closePopup=function(o){var i;return e&&(i="string"==typeof o?o===e:"array"===$.type(o)?o.indexOf(e)>=0:!0)?("function"==typeof t[e].onunload&&t[e].onunload(),document.getElementById(e).style.display="",i=e,n.className=n.style.display=e="","function"==typeof l.popupEvents.onhide&&l.popupEvents.onhide({type:"hide",id:i}),!0):void 0},l.getCurrentPopup=function(){return e},l.popupEvents={},$("#popups > div > a").on("click",function(){l.closePopup()})}(),!function(){function n(){i=$(window).innerWidth(),s=$(window).innerHeight(),"number"==typeof u.current&&$.isPlainObject(p[u.current])&&o(u.current)}function t(e,n){p[e]=new Image,p[e].style.position="absolute",p[e].style.bottom=p[e].style.right="100%",p[e].onload=function(){var n={w:this.width,h:this.height};document.body.removeChild(p[e]),p[e]=n,u.current===e&&o(e)},p[e].src=n,document.body.appendChild(p[e])}function o(e){u.children[e].css("background-size",p[e].w>i||p[e].h>s?"contain":"")}var i,s,a=$("#photoview"),d=a.find(".close"),c=a.find(".prev"),r=a.find(".next"),u=e(a.find(">div")),p=[];l.showPhotoView=function(e,n){var o;if("array"===$.type(e)){for(o=0;o<e.length;o++)u.add($('<div style="background-image:url('+e[o]+')"></div>')),t(o,e[o]);n>=0&&n<u.children.length&&u.slideTo(n,!0),u.children.length>1?(c.css("display","block"),r.css("display","block")):(c.css("display",""),r.css("display",""))}},l.hidePhotoView=function(){for(;u.children.length;)$.isPlainObject(p[0])||(p[0].onload=null,document.body.removeChild(p[0])),p.shift(),u.remove(0)},$(window).on("resize",n),c.on("click",function(){u.slideTo(u.current-1)}),r.on("click",function(){u.slideTo(u.current+1)}),d.on("click",l.hidePhotoView),u.onchange=function(){void 0===this.current?a.css("display",""):($.isPlainObject(p[this.current])&&o(this.current),a.css("display","block"))},n()}(),!function(){var e,n,t,o=(document.getElementById("hintCtn"),0),i=document.getElementById("dialogs"),s=[];l.showLoading=function(e){$("#loading > div > div").text(e?e:"加载中..."),0===o&&(document.getElementById("loading").style.display="block"),o+=1},l.hideLoading=function(){o>0&&(o-=1,0===o&&(document.getElementById("loading").style.display="","function"==typeof l.dialogEvents.onloaded&&l.dialogEvents.onloaded({type:"loaded"})))},l.isLoading=function(){return o>0},l.hint=function(n,t,o){var i=$("#hint");i.prop("className",t?t:""),i.find("span").text(n),e?clearTimeout(e):(i.css("display","block"),i[0].offsetWidth,i.fadeIn()),o||(o="error"===t?4e3:"warning"===t?3e3:2e3),e=setTimeout(function(){e=0,i.fadeOut(function(){i.css("display","")})},o)},l.showReadable=function(e,n,o,i){var s=$("#readable");"string"==typeof e?s.find(">div").css("width",n).css("height",o).find(">div").html(e):s.find(">div").css("width",n).css("height",o).find(">div").append(e),s.css("display","block"),t=i},l.hideReadable=function(){"function"==typeof t&&(t(),t=void 0),$("#readable").css("display","").find(">div>div>*").remove()},l.hideDialog=function(e){var t;"function"==typeof n&&("isConfirm"===i.className?n(e):"isAlert"===i.className&&n(),n=void 0),i.className="",s.length>0&&(t=s[0][0],s[0].shift(),l[t].apply(this,s[0]),s.shift())},l.showForeign=function(e,n,t,o){l.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" style="width:100%;height:100%;" src="'+e+'"></iframe>',n,t,o)},l.confirm=function(e,t,o,a){var d,l;""===i.className?(d=$(i).find(">div"),l=d.find(">div>div"),n=t,d.css("width",o||"400px"),l.text(e),i.className="isConfirm",d.css("height",l.outerHeight()+Math.max($(i).find(">div>a.yes").outerHeight(),$(i).find(">div>a.no").outerHeight())+76+"px")):s.push(["confirm",e,t,o,a])},l.alert=function(e,t,o,a){var d,l;""===i.className?(d=$(i).find(">div"),l=d.find(">div>div"),n=t,d.css("width",o||"400px"),l.text(e),i.className="isAlert",d.css("height",l.outerHeight()+46+"px")):s.push(["alert",e,t,o])},$("#readable>div>a").on("click",l.hideReadable),$(window).on("keydown",function(e){27===e.keyCode&&"block"===$("#readable").css("display")&&l.hideReadable()}),$(i).find(">div>a.close").on("click",l.hideDialog),$(i).find(">div>a.yes").on("click",function(){l.hideDialog(!0)}),$(i).find(">div>a.no").on("click",function(){l.hideDialog(!1)}),l.dialogEvents={}}(),!function(){function e(){var e=l.parseHash(location.hash),a=history.state,d=e.id!==t;history.replaceState&&history.replaceState(!0,null),l.location&&l.isSameLocation(l.location,e)||(l.location=e,l.closePanel(),l.closePopup(),l.hideReadable(),"function"==typeof o&&o(d),i("page",n[e.id],e.id,function(){var o,i;d?(t?("function"==typeof n[t].onunload&&n[t].onunload(),document.getElementById(t).style.display="",o=!s&&!a):"autopopup"in e.args&&l.openPopup(e.args.autopopup,e.args.autopopuparg?JSON.parse(e.args.autopopuparg):void 0),document.body.className=t=e.id,document.getElementById(e.id).style.display="block","function"==typeof n[e.id].onload&&n[e.id].onload(!0),o?(i=Math.max(document.body.scrollTop,document.documentElement.scrollTop),i>0&&$("html,body").animate({scrollTop:0},i)):s&&(s.scrollTop=0)):"function"==typeof n[e.id].onload&&n[e.id].onload()}))}var t,o,s;l.init=function(n,t,i){var a;d=n,s=t,o=i,"onhashchange"in window?$(window).on("hashchange",e):setInterval(function(){a!==location.hash&&(a=location.hash,e())},10),e()},l.setHome=function(t){var o;return t in n&&(o=d,d=t,l.location&&l.location.id===o&&!l.isSameLocation(l.location,l.parseHash(location.hash)))?(e(),!0):void 0},l.reloadPage=function(e){(!e||"string"==typeof e&&e===l.location.id||e.indexOf(l.location.id)>=0)&&(l.closePanel(),l.closePopup(),l.hideReadable(),"function"==typeof n[t].onunload&&n[t].onunload(),"function"==typeof n[t].onload&&n[t].onload(!0))}}(),l});