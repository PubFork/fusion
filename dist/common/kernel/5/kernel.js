'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};define(['common/slider/slider','site/pages/pages','site/popups/popups','site/panels/panels'],function(a,b,c,d){function e(a,b,c){var d,e=b+'/'+c+'/';if(2===a.loaded&&'function'==typeof a.ondestory&&a.ondestory(),$('#'+c).remove(),a.css&&'string'!=typeof a.css&&(a.css=k.removeCss(a.css).substr(require.toUrl(e).length)),a.js&&(e+=a.js,require.defined(e)&&(d=require(e),require.undef(e),d)))for(e in d)delete a[e];a.loaded=0}function f(a,b,c,d){function f(){var f;'js'in b?(k.showLoading(),f=l+b.js,require([f],function(a){a&&Object.assign(b,a),b.loaded=2,d(),k.hideLoading()},require.data.debug?void 0:function(d){e(b,a,c),d.requireType&&'scripterror'!==d.requireType&&'nodefine'!==d.requireType||d.xhr&&404!==d.xhr.status?g(f,d.message,m):h(m),k.hideLoading()})):(b.loaded=2,d())}if(2===b.loaded)d();else if(1!==b.loaded){b.loaded=1;var i,j='#'+a+'s',l=a+'/'+c+'/',n=require.toUrl(l),m='page'===a;'popup'===a?j+='>div>div':'panel'===a&&(j+='>.contents>div'),j=$(j)[0],'string'==typeof b.css&&(b.css=k.appendCss(n+b.css)),'html'in b?(i=n+b.html,$.ajax({url:i,type:'get',dataType:'text',success:function success(a){j.insertAdjacentHTML('afterBegin','<div id="'+c+'">'+a+'</div>'),f()},error:function error(d){e(b,a,c),require.data.debug||404!==d.status?g(i,d.status,m):h(m)},complete:k.hideLoading}),k.showLoading()):(j.insertAdjacentHTML('afterBegin','<div id="'+c+'"></div>'),f())}}function g(a,b,c){k.alert('\u52A0\u8F7D'+a+'\u65F6\u53D1\u751F\u4E86\u4E00\u4E2A\u9519\u8BEF: '+b,c?function(){history.back()}:void 0)}function h(a){a?location.reload():k.confirm('\u7F51\u7AD9\u5DF2\u7ECF\u66F4\u65B0, \u4F7F\u7528\u8BE5\u529F\u80FD\u9700\u8981\u5148\u91CD\u65B0\u52A0\u8F7D. \u662F\u5426\u7ACB\u5373\u5237\u65B0\u672C\u9875?',function(a){a&&location.reload()})}function i(){k.closePanel(),k.closePopup(),k.hideReadable()}var j,k={appendCss:function appendCss(a){var b=document.createElement('link');return /\.less$/.test(a)?'object'===('undefined'==typeof less?'undefined':_typeof(less))?(b.rel='stylesheet/less',b.href=a,less.sheets.push(b),less.refresh()):(b.rel='stylesheet',b.href=a.replace(/less$/,'css')):(b.rel='stylesheet',b.href=a),(document.head||document.getElementsByTagName('head')[0]).appendChild(b)},removeCss:function removeCss(a){return $(a).remove(),'stylesheet/less'===a.rel&&(less.sheets.splice(less.sheets.indexOf(a),1),less.refresh()),a.getAttribute('href')},buildHash:function buildHash(a){var b,c='#!'+encodeURIComponent(a.id);for(b in a.args)c+=void 0===a.args[b]?'&'+encodeURIComponent(b):'&'+encodeURIComponent(b)+'='+encodeURIComponent(a.args[b]);return c},parseHash:function parseHash(c){var d,e,a,f={id:j,args:{}};if(c=c.substr(1).replace(/[#\?].*$/,''),a=c.match(/[^=&]+(=[^&]*)?/g),a)for('!'===a[0].charAt(0)&&(e=a[0].substr(1),(e in b)&&(f.id=decodeURIComponent(e))),d=1;d<a.length;d++)e=a[d].match(/^([^=]+)(=)?(.+)?$/),e&&(f.args[decodeURIComponent(e[1])]=e[2]?decodeURIComponent(e[3]||''):void 0);return f},isSameLocation:function isSameLocation(a,b){if(a.id===b.id&&Object.keys(a.args).length===Object.keys(b.args).length){for(var c in a.args){if(!(c in b.args))return!1;if(void 0===a.args[c]){if(void 0!==b.args[c])return!1;}else if(''+a.args[c]!=''+b.args[c])return!1}return!0}return!1},replaceLocation:function replaceLocation(a){k.location&&k.isSameLocation(a,k.location)?k.reloadPage():location.replace(k.buildHash(a))}};return!function(){function a(a,b){var c,d;for(a.xEvents[b.type].locked=!0,c=0;c<a.xEvents[b.type].length;c++)a.xEvents[b.type][c].call(a,b);for(a.xEvents[b.type].locked=!1;a.xEvents[b.type].stack.length;)a.xEvents[b.type].stack[0]?(d=a.xEvents[b.type].indexOf(a.xEvents[b.type].stack[0][1]),a.xEvents[b.type].stack[0][0]?0<=d&&a.xEvents[b.type].splice(d,1):0>d&&a.xEvents[b.type].push(a.xEvents[b.type].stack[0][1])):a.xEvents[b.type].splice(0,a.xEvents[b.type].length),a.xEvents[b.type].stack.shift();if(a.xEvents[b.type].length||(delete a.xEvents[b.type],a['on'+b.type]=null),a.xEvents.removeMark){for(c in delete a.xEvents.removeMark,a.xEvents)delete a.xEvents[c],a['on'+c]=null;delete a.xEvents}}k.listeners={add:function add(b,c,d){b.xEvents||(b.xEvents=function(c){a(b,c)}),b.xEvents[c]||(b.xEvents[c]=[],b.xEvents[c].stack=[],b.xEvents[c].locked=!1,b['on'+c]=b.xEvents),b.xEvents[c].locked?b.xEvents[c].stack.push([!1,d]):0>b.xEvents[c].indexOf(d)&&b.xEvents[c].push(d)},list:function list(a,b){var c,d;if(b)c=a.xEvents&&a.xEvents[b]?a.xEvents[b].slice(0):[];else if(c={},a.xEvents)for(d in a.xEvents)'array'===$.type(a.xEvents[d])&&a.xEvents[d].length&&(c[d]=a.xEvents[d].slice(0));return c},remove:function remove(a,b,c){var d,e,f;if(a.xEvents)if(b)a.xEvents[b]&&(a.xEvents[b].locked?c?a.xEvents[b].stack.push([!0,c]):a.xEvents[b].stack.push(null):c?(f=a.xEvents[b].indexOf(c),0<=f&&a.xEvents[b].splice(f,1)):a.xEvents[b].splice(0,a.xEvents[b].length),0===a.xEvents[b].length&&(delete a.xEvents[b],a['on'+b]=null));else if(!a.xEvents.removeMark){for(d in a.xEvents)a.xEvents[d].locked?e=!0:(delete a.xEvents[d],a['on'+d]=null);e?a.xEvents.removeMark=!0:delete a.xEvents}}}}(),!function(){function a(a,b){g=!0,j.animate({"margin-left":b?'-100%':'0%'},{duration:200,complete:function complete(){g=!1,a(),'function'==typeof h&&(h(),h=void 0)}})}function b(){'function'==typeof d[c].onunload&&d[c].onunload(),a(function(){'function'==typeof d[c].onunloadend&&d[c].onunloadend(),document.getElementById(c).style.display=i[0].style.display='',c=void 0},!1)}var c,g,h,i=$('#panels'),j=i.find('>.contents>div');k.openPanel=function(a,b){var c=d[a];return c?(f('panel',c,a,function(){'function'==typeof c.open?c.open(b):k.showPanel(a,b)}),!0):void k.hint('panel config not found: '+a,'error')},k.showPanel=function(e,f){function j(){setTimeout(function(){h=function(){k.showPanel(e,f)}},0)}g?j():c?(b(),j()):('function'==typeof d[e].onload&&d[e].onload(f),i[0].className=c=e,i[0].style.display=document.getElementById(e).style.display='block',a(function(){'function'==typeof d[e].onloadend&&d[e].onloadend()},!0))},k.closePanel=function(a){var d;g?setTimeout(function(){h=function(){k.closePanel(a)}},0):c&&(d='string'==typeof a?a===c:'array'!==$.type(a)||0<=a.indexOf(c),d?b():h&&(h=void 0))},k.destoryPanel=function(a){var b=d[a];b&&e(b,'panel',a)},i.find('>.mask').on('click',k.closePanel),j.find('>.close').on('click',k.closePanel)}(),!function(){var a,b=document.getElementById('popups');k.openPopup=function(a,b){var d=c[a];return d?(f('popup',d,a,function(){'function'==typeof d.open?d.open(b):k.showPopup(a,b)}),!0):void k.hint('popup config not found: '+a,'error')},k.showPopup=function(d,e){var f,g=c[d];a?('function'==typeof c[a].onunload&&c[a].onunload(),document.getElementById(a).style.display=''):(b.style.display='block',f=!0),a=d,b.className=d,document.getElementById(d).style.display='block',f&&'function'==typeof k.popupEvents.onshow&&k.popupEvents.onshow({type:'show'}),'function'==typeof g.onload&&g.onload(e)},k.closePopup=function(d){var e;if(a&&(e='string'==typeof d?d===a:'array'!==$.type(d)||0<=d.indexOf(a),e))return'function'==typeof c[a].onunload&&c[a].onunload(),document.getElementById(a).style.display='',e=a,b.className=b.style.display=a='','function'==typeof k.popupEvents.onhide&&k.popupEvents.onhide({type:'hide',id:e}),!0},k.getCurrentPopup=function(){return a},k.destoryPopup=function(a){var b=c[a];b&&e(b,'popup',a)},k.popupEvents={},$(b).find('>div>a').on('click',function(){k.closePopup()})}(),!function(){function b(){var a=$(window);f=a.innerWidth(),g=a.innerHeight(),'number'==typeof n.current&&o[n.current]&&e(n.current)}function c(a){n.children[a].one('load',function(){o[a]={w:this.width,h:this.height},p[a]=0,n.current===a&&e(a),this.style.visibility='visible'})}function e(a){var b,c,e,h,i,j=p[a]%2;j?(h=o[a].h,i=o[a].w):(h=o[a].w,i=o[a].h),h>f||i>g?(b=h/i,f/g>b?(e=g,c=e*b):(c=f,e=c/b),j?(h=e,i=c):(h=c,i=e),n.children[a].css('cursor','zoom-in')):(h=o[a].w,i=o[a].h,n.children[a].css('cursor','')),n.children[a].css({top:(g-i)/2+'px',left:(f-h)/2+'px',width:h+'px',height:i+'px',transform:'rotate('+90*p[a]+'deg)'})}var f,g,d=$('#photoview'),h=d.find('.close'),j=d.find('.prev'),l=d.find('.next'),i=d.find('.rotate.p'),m=d.find('.rotate.n'),n=a(d.find('>div')),o=[],p=[];k.showPhotoView=function(a,b){var d;if('array'===$.type(a)){for(d=0;d<a.length;d++)n.add($('<img src="'+a[d]+'"/>')),c(d);0<=b&&b<n.children.length&&n.slideTo(b,!0),1<n.children.length?(j.css('display','block'),l.css('display','block')):(j.css('display',''),l.css('display',''))}},k.hidePhotoView=function(){for(o=[];n.children.length;)n.remove(0)},d.on('click','>div>img',function(){var a;'zoom-in'===this.style.cursor?(a=p[n.current]%2,a?(this.style.top=o[n.current].w>g?(o[n.current].w-o[n.current].h)/2+'px':(g-o[n.current].h)/2+'px',this.style.left=o[n.current].h>f?(o[n.current].h-o[n.current].w)/2+'px':(f-o[n.current].w)/2+'px'):(this.style.top=o[n.current].h>g?0:(g-o[n.current].h)/2+'px',this.style.left=o[n.current].w>f?0:(f-o[n.current].w)/2+'px'),this.style.width=o[n.current].w+'px',this.style.height=o[n.current].h+'px',this.style.cursor='zoom-out'):'zoom-out'===this.style.cursor&&e(n.current)}),$(window).on('resize',b),j.on('click',function(){n.slideTo(n.current-1)}),l.on('click',function(){n.slideTo(n.current+1)}),i.on('click',function(){'number'==typeof p[n.current]&&(p[n.current]++,e(n.current))}),m.on('click',function(){'number'==typeof p[n.current]&&(p[n.current]--,e(n.current))}),h.on('click',k.hidePhotoView),n.onchange=function(){void 0===this.current?d.css('display',''):(o[this.current]&&e(this.current),d.css('display','block'))},'transform'in document.documentElement.style&&(i.css('display','block'),m.css('display','block')),b()}(),!function(){var a,b,c,d=0,e=$('#hint'),f=$('#readable'),g=$('#dialogs'),h=$('#loading'),i=[];k.showLoading=function(a){h.find('>div>div').text(a?a:'\u52A0\u8F7D\u4E2D...'),0==d&&h.css('display','block'),d+=1},k.hideLoading=function(){0<d&&(d-=1,0==d&&(h.css('display',''),'function'==typeof k.dialogEvents.onloaded&&k.dialogEvents.onloaded({type:'loaded'})))},k.isLoading=function(){return 0<d},k.hint=function(b,c,d){e[0].className=c||'',e.find('span').text(b),a?clearTimeout(a):(e.css('display','block'),e[0].offsetWidth,e.fadeIn()),d||(d='error'===c?4e3:'warning'===c?3e3:2e3),a=setTimeout(function(){a=0,e.fadeOut(function(){e.css('display','')})},d)},k.showReadable=function(a,b,d,e,g){f.prop('className',g||'').css('display','block').find('>div').css({width:b,height:d}).find('>div').append(a),c=e},k.hideReadable=function(){'function'==typeof c&&(c(),c=void 0),f.css('display','').find('>div>div>*').remove()},k.hideDialog=function(a){var c;'function'==typeof b&&('isConfirm'===g[0].className?b(a):'isAlert'===g[0].className&&b(),b=void 0),g[0].className='',0<i.length&&(c=i[0][0],i[0].shift(),k[c].apply(this,i[0]),i.shift())},k.showForeign=function(a,b,c,d){k.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+a+'"></iframe>',b,c,d,'foreign')},k.confirm=function(a,c,d,e){var f,h;''===g[0].className?(f=g.find('>div'),h=f.find('>div>div'),b=c,f.css('width',d||'400px'),h.text(a),g[0].className='isConfirm',f.css('height',h.outerHeight()+Math.max(g.find('>div>a.yes').outerHeight(),g.find('>div>a.no').outerHeight())+76+'px')):i.push(['confirm',a,c,d,e])},k.alert=function(a,c,d){var e,f;''===g[0].className?(e=g.find('>div'),f=e.find('>div>div'),b=c,e.css('width',d||'400px'),f.text(a),g[0].className='isAlert',e.css('height',f.outerHeight()+46+'px')):i.push(['alert',a,c,d])},f.find('>div>a').on('click',k.hideReadable),g.find('>div>a.close').on('click',k.hideDialog),g.find('>div>a.yes').on('click',function(){k.hideDialog(!0)}),g.find('>div>a.no').on('click',function(){k.hideDialog(!1)}),k.dialogEvents={}}(),!function(){function a(a,c){(!a||'string'==typeof a&&a===d||'array'===$.type(a)&&0<=a.indexOf(d))&&(!c&&i(),'function'==typeof b[d].onunload&&b[d].onunload(),'function'==typeof b[d].onload&&b[d].onload(!0))}function c(){var a=k.parseHash(location.hash);k.location&&k.isSameLocation(k.location,a)||(k.lastLocation=k.location,k.location=a,i(),'function'==typeof k.pageEvents.onroute&&k.pageEvents.onroute({type:'route'}),f('page',b[a.id],a.id,function(){a.id===d?'function'==typeof b[a.id].onload&&b[a.id].onload():(d?('function'==typeof b[d].onunload&&b[d].onunload(),document.getElementById(d).style.display=''):'autopopup'in a.args&&k.openPopup(a.args.autopopup,a.args.autopopuparg?JSON.parse(a.args.autopopuparg):void 0),document.body.className=d=a.id,document.getElementById(a.id).style.display='block','function'==typeof b[a.id].onload&&b[a.id].onload(!0)),'function'==typeof k.pageEvents.onroutend&&k.pageEvents.onroutend({type:'routend'})}))}var d;k.init=function(a){var d;if(a in b){if(!j)return j=a,'onhashchange'in window?$(window).on('hashchange',c):setInterval(function(){d!==location.hash&&(d=location.hash,c())},10),c(),!0;if(d=j,j=a,k.location&&k.location.id===d&&!k.isSameLocation(k.location,k.parseHash(location.hash)))return c(),!0}},k.reloadPage=function(b,c){function d(f){k.listeners.remove(this,f.type,d),k.isSameLocation(e,k.location)&&a(b,c)}var e;k.isLoading()?(e=k.location,k.listeners.add(k.dialogEvents,'loaded',d)):a(b,c)},k.destoryPage=function(a){var c=b[a];c&&e(c,'page',a)},k.pageEvents={}}(),k});