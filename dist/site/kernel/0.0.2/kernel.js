"use strict";define("site/kernel/kernel",["site/pages/pages","site/popups/popups"],function(e,n){function t(e,n,t,a){function d(){var n;"js"in e?(i.showLoading(),n=p+e.js,require([n],function(n){delete e.js,n&&i.extendIn(e,n,r),e.loaded=2,a(),i.hideLoading()},function(a){e.loaded=0,require.data.debug||a.requireType&&"scripterror"!==a.requireType&&"nodefine"!==a.requireType||a.xhr&&404!==a.xhr.status?(require.undef(n),o(n,a.message,t)):s(t),i.hideLoading()})):(e.loaded=2,a())}var l,c,r,p,u,v;2===e.loaded?a():1!==e.loaded&&(e.loaded=1,t?(l="#page",c="page",r=["onload","onunload"]):(l="#popup > div > div",c="popup",r=["onload","onunload","open"]),p=c+"/"+n+"/",u=require.toUrl(p),"css"in e&&(i.appendCss(u+e.css),delete e.css),"html"in e?(v=u+e.html,$.ajax({url:v,type:"get",dataType:"text",success:function(t){delete e.html,$(l).append('<div id="'+n+'">'+t+"</div>"),d()},error:function(n,i){e.loaded=0,require.data.debug||404!==n.status?o(v,n.status,t):s(t)},complete:i.hideLoading}),i.showLoading()):($(l).append('<div id="'+n+'"></div>'),d()))}function o(e,n,t){i.alert("加载"+e+"时发生了一个错误: "+n,t?function(){history.back()}:void 0)}function s(e){e?location.reload():i.confirm("网站已经更新, 使用该功能需要先重新加载. 是否立即刷新本页?",function(e){e&&location.reload()})}var i={appendCss:function(e){var n=document.createElement("link");n.type="text/css",/\.less$/.test(e)?"object"==typeof less?(n.rel="stylesheet/less",n.href=e,less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=e.replace(/less$/,"css")):(n.rel="stylesheet",n.href=e),(document.head||document.getElementsByTagName("head")[0]).appendChild(n)},extendIn:function(e,n,t){for(var o=0;o<t.length;o++)t[o]in n&&(e[t[o]]=n[t[o]])},buildHash:function(e){var n,t="#!"+encodeURIComponent(e.id);for(n in e.args)t+=void 0===e.args[n]?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(e.args[n]);return t},parseHash:function(n){var t,o,s,i={id:"home",args:{}};if(n=n.substr(1).replace(/[#\?].*$/,""),s=n.match(/[^=&]+(=[^&]*)?/g)){"!"===s[0].charAt(0)&&(o=s[0].substr(1),o in e&&(i.id=decodeURIComponent(o)));for(t=1;t<s.length;t++)o=s[t].match(/^([^=]+)(?:=(.+))?$/),o&&(i.args[decodeURIComponent(o[1])]=o.length>1?decodeURIComponent(o[2]):void 0)}return i},isSameLocation:function(e,n){var t;if(e.id===n.id&&Object.keys(e.args).length===Object.keys(n.args).length){for(t in e.args)if(!(t in n.args)||e.args[t]!==n.args[t])return!1;return!0}return!1}};return!function(){function e(e,n){var t,o,s;for(e.xEvents[n.type].locked=!0,t=0;t<e.xEvents[n.type].length;t++)e.xEvents[n.type][t].call(e,n);for(e.xEvents[n.type].locked=!1;e.xEvents[n.type].stack.length>0;)e.xEvents[n.type].stack[0]?(o=e.xEvents[n.type].indexOf(e.xEvents[n.type].stack[0][1]),e.xEvents[n.type].stack[0][0]?-1!==o&&e.xEvents[n.type].splice(o,1):-1===o&&e.xEvents[n.type].push(e.xEvents[n.type].stack[0][1])):e.xEvents[n.type].splice(0,e.xEvents[n.type].length),e.xEvents[n.type].stack.shift();if(0===e.xEvents[n.type].length&&(delete e.xEvents[n.type],e.removeEventListener?e.removeEventListener(n.type,e.xEvents,!1):e.detachEvent?e.detachEvent("on"+n.type,e.xEvents):e["on"+n.type]=null),e.xEvents.removeMark){delete e.xEvents.removeMark;for(s in e.xEvents)delete e.xEvents[s],e.removeEventListener?e.removeEventListener(s,e.xEvents,!1):e.detachEvent?e.detachEvent("on"+s,e.xEvents):e["on"+s]=null;e.xEvents=null}}i.listeners={add:function(n,t,o){n.xEvents||(n.xEvents=function(t){e(n,t)}),n.xEvents[t]||(n.xEvents[t]=[],n.xEvents[t].stack=[],n.xEvents[t].locked=!1,n.addEventListener?n.addEventListener(t,n.xEvents,!1):n.attachEvent?n.attachEvent("on"+t,n.xEvents):n["on"+t]=n.xEvents),n.xEvents[t].locked?n.xEvents[t].stack.push([!1,o]):n.xEvents[t].indexOf(o)<0&&n.xEvents[t].push(o)},list:function(e,n){var t,o;if(n)t=e.xEvents&&e.xEvents[n]?e.xEvents[n].slice(0):[];else if(t={},e.xEvents)for(o in e.xEvents)e.xEvents[o]instanceof Array&&e.xEvents[o].length>0&&(t[o]=e.xEvents[o].slice(0));return t},remove:function(e,n,t){var o,s,i;if(e.xEvents)if(n)e.xEvents[n]&&(e.xEvents[n].locked?t?e.xEvents[n].stack.push([!0,t]):e.xEvents[n].stack.push(null):t?(i=e.xEvents[n].indexOf(t),-1!==i&&e.xEvents[n].splice(i,1)):e.xEvents[n].splice(0,e.xEvents[n].length),0===e.xEvents[n].length&&(delete e.xEvents[n],e.removeEventListener?e.removeEventListener(n,e.xEvents,!1):e.detachEvent?e.detachEvent("on"+n,e.xEvents):e["on"+n]=null));else if(!e.xEvents.removeMark){for(o in e.xEvents)e.xEvents[o].locked?s=!0:(delete e.xEvents[o],e.removeEventListener?e.removeEventListener(o,e.xEvents,!1):e.detachEvent?e.detachEvent("on"+o,e.xEvents):e["on"+o]=null);s?e.xEvents.removeMark=!0:e.xEvents=null}}}}(),!function(){var e,o=document.getElementById("popup");i.openPopup=function(e,o){var s=n[e];s?t(s,e,!1,function(){"function"==typeof s.open?s.open(o):i.showPopup(e,o)}):i.hint("popup config not found: "+e)},i.showPopup=function(t,s){var a,d=n[t];e?("function"==typeof n[e].onunload&&n[e].onunload(),document.getElementById(e).style.display=""):(o.style.display="block",a=!0),e=t,o.className=t,document.getElementById(t).style.display="block",a&&"function"==typeof i.popupEvents.onshow&&i.popupEvents.onshow({type:"show"}),"function"==typeof d.onload&&d.onload(s)},i.closePopup=function(t){var s;return e&&(s="string"==typeof t?t===e:t instanceof Array?t.indexOf(e)>=0:!0)?("function"==typeof n[e].onunload&&n[e].onunload(),document.getElementById(e).style.display="",o.className=o.style.display=e="","function"==typeof i.popupEvents.onhide&&i.popupEvents.onhide({type:"hide"}),!0):void 0},i.getCurrentPopup=function(){return e},i.popupEvents={},$("#popup > div > a").on("click",function(){i.closePopup()})}(),!function(){var e,n,t,o=(document.getElementById("hintCtn"),0),s=document.getElementById("dialog"),a=[];i.showLoading=function(e){$("#loading > div > div").text(e?e:"正在为您努力加载中..."),0===o&&(document.getElementById("loading").style.display="block"),o+=1},i.hideLoading=function(){o>0&&(o-=1,0===o&&(document.getElementById("loading").style.display="","function"==typeof i.dialogEvents.onloaded&&i.dialogEvents.onloaded({type:"loaded"})))},i.isLoading=function(){return o>0},i.hint=function(n,t){var o=$("#hint");o.find("span").text(n),e?clearTimeout(e):(o.css("display","block"),o[0].offsetWidth,o.fadeIn()),e=setTimeout(function(){e=0,o.fadeOut(function(){o.css("display","")})},t?t:4e3)},i.showReadable=function(e,n,o,s){var i=$("#readable");"string"==typeof e?i.find(">div").css("width",n).css("height",o).find(">div").html(e):i.find(">div").css("width",n).css("height",o).find(">div").append(e),i.css("display","block"),t=s},i.hideReadable=function(){"function"==typeof t&&(t(),t=void 0),$("#readable").css("display","").find(">div>div>*").remove()},i.hideDialog=function(e){var t;"function"==typeof n&&("confirm"===s.className?n(e):"alert"===s.className&&n(),n=void 0),s.className="",a.length>0&&(t=a[0][0],a[0].shift(),i[t].apply(this,a[0]),a.shift())},i.showForeign=function(e,n,t,o){i.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" style="width:100%;height:100%;" src="'+e+'"></iframe>',n,t,o)},i.confirm=function(e,t,o,i){var d,l;""===s.className?(d=$(s).find(">div"),l=d.find(">div>div"),n=t,d.css("width",o||"400px"),l.text(e),s.className="confirm",d.css("height",l.outerHeight()+82+"px")):a.push(["confirm",e,t,o,i])},i.alert=function(e,t,o,i){var d,l;""===s.className?(d=$(s).find(">div"),l=d.find(">div>div"),n=t,d.css("width",o||"400px"),l.text(e),s.className="alert",d.css("height",l.outerHeight()+50+"px")):a.push(["alert",e,t,o])},$("#readable > div > a").on("click",i.hideReadable),$(window).on("keydown",function(e){27===e.keyCode&&"block"===$("#readable").css("display")&&i.hideReadable()}),$(s).find(">div>a.close").on("click",i.hideDialog),$(s).find(">div>a.yes").on("click",function(){i.hideDialog(!0)}),$(s).find(">div>a.no").on("click",function(){i.hideDialog(!1)}),i.dialogEvents={}}(),!function(){function n(){var n=i.parseHash(location.hash),s=history.state;history.replaceState&&history.replaceState(!0,null),i.location&&i.isSameLocation(i.location,n)||("undefined"!=typeof _hmt&&_hmt.push&&_hmt.push(["_trackPageview","/"+i.buildHash(n)]),i.location=n,i.closePopup(),i.hideReadable(),t(e[i.location.id],i.location.id,!0,function(){var n,t;i.location.id!==o?(o?("function"==typeof e[o].onunload&&e[o].onunload(),document.getElementById(o).style.display="",n=!s):"autopopup"in i.location.args&&(i.openPopup(i.location.args.autopopup,i.location.args.autopopuparg),delete i.location.args.autopopup,delete i.location.args.autopopuparg),document.body.className=o=i.location.id,document.getElementById(i.location.id).style.display="block","function"==typeof e[i.location.id].onload&&e[i.location.id].onload(!0),n&&(t=Math.max(document.body.scrollTop,document.documentElement.scrollTop),t>0&&$("html,body").animate({scrollTop:0},t))):"function"==typeof e[i.location.id].onload&&e[i.location.id].onload()}))}var o;i.start=function(e){var t;"onhashchange"in window?$(window).on("hashchange",n):setInterval(function(){t!==location.hash&&(t=location.hash,n())},10),n()},i.reloadPage=function(){i.closePopup(),i.hideReadable(),"function"==typeof e[o].onunload&&e[o].onunload(),"function"==typeof e[o].onload&&e[o].onload(!0)}}(),i});